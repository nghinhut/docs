@startuml
'-----START auto generated metadata please keep comment here to allow auto update-----
'-----DON'T EDIT THIS SECTION, INSTEAD RE-RUN prebuild.sh TO UPDATE-----
header [[https://www.nghinhut.dev?from=http%5C%3A%5C%2F%5C%2Fwww%5C.plantuml%5C.com%5C%2Fplantuml%5C%2Fproxy%3Ffmt%3Dsvg%5C%26src%3Dhttps%5C%3A%5C%2F%5C%2Fgitlab%5C.com%5C%2Fnghinhut%5C%2Fdocs%5C%2Fraw%5C%2F015d4bf43be4409bb204e41e9ebdb86cd47660cf%5C%2FIdM%5C%2Fuc02%5C.puml%0A @nghinhut]]
footer [[http://www.plantuml.com/plantuml/proxy?fmt=svg&src=https://gitlab.com/nghinhut/docs/raw/015d4bf43be4409bb204e41e9ebdb86cd47660cf/IdM/uc02.puml https://gitlab.com/nghinhut/docs/blob/015d4bf43be4409bb204e41e9ebdb86cd47660cf/IdM/uc02.puml]]
'-----END auto generated metadata please keep comment here to allow auto update-----
title ListUsers
!$REPO_URL = "https://gitlab.com/nghinhut/docs/raw/master/IdM"
!$PLANTUML_PROXY_URL = "http://www.plantuml.com/plantuml/proxy"
!$BASE_URL = $PLANTUML_PROXY_URL + "?fmt=svg&src=" + $REPO_URL

participant "Client" as client
participant "IdM Service" as idm
participant "IdM Database" as db
participant "UMA2 Authorization Server" as as
participant "Encryption Service" as es

ref over client, idm, as
    [[$BASE_URL/create-permission-ticket.function.puml{} Create Permission Ticket]] with resources scopes = [ 'list-users' ]
end

client ->> idm : list users
activate idm
    ref over idm
        [[$BASE_URL/query-encrypted-users.function.puml Query Encrypted Users]] by [ username | email ]
    end
    client <<-- idm
deactivate idm

@enduml
